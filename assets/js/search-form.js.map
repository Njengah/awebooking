{"version":3,"names":[],"mappings":"","sources":["search-form.js"],"sourcesContent":["(function ($, ko, plugin) {\n  'use strict';\n\n  function formatDate(date) {\n    const _date = flatpickr.parseDate(date);\n\n    if (!_date) {\n      return '';\n    }\n\n    return flatpickr.formatDate(_date, plugin.i18n.dateFormat);\n  }\n\n  function SearchFormModel(data = {}) {\n    this.adult    = ko.observable(data.adult || 1);\n    this.children = ko.observable(data.children || 0);\n    this.infants  = ko.observable(data.infants || 0);\n    this.checkIn  = ko.observable(data.checkIn || '2018-07-05');\n    this.checkOut = ko.observable(data.checkOut || '2018-07-10');\n\n    this.checkInFormatted = ko.computed(() => {\n      return formatDate(this.checkIn());\n    });\n\n    this.checkOutFormatted = ko.computed(() => {\n      return formatDate(this.checkOut());\n    });\n  }\n\n  class SearchForm {\n    constructor (el) {\n      const self = this;\n\n      this.$el = $(el);\n      this.model = new SearchFormModel();\n      ko.applyBindings(this.model, el);\n\n      $('.searchbox__box', this.$el).each((i, box) => {\n        $(box).data('popup', this.setuptPopper(box));\n      });\n\n      const $rangepicker = this.$el.find('[data-hotel=\"rangepicker\"]');\n      const fp = awebooking.datepicker($rangepicker[0], {\n        mode: 'range',\n        clickOpens: false,\n        closeOnSelect: true,\n\n        onReady() {\n          this.config.ignoredFocusElements.push($('.searchbox__box--checkin', self.$el)[0]);\n          this.config.ignoredFocusElements.push($('.searchbox__box--checkout', self.$el)[0]);\n        },\n\n        onChange: (dates) => {\n          if (dates.length === 0) {\n            this.model.checkIn(null);\n            this.model.checkIn(null);\n          } else if (dates.length === 1) {\n            this.model.checkIn(dates[0]);\n            this.model.checkOut(null);\n          } else {\n            this.model.checkIn(dates[0]);\n            this.model.checkOut(dates[1]);\n          }\n        },\n\n        onPreCalendarPosition() {\n          fp._positionElement = $('.searchbox__box--checkout')[0];\n          setTimeout(() => { this._positionElement = this._input; }, 0);\n        },\n      });\n\n      $('.searchbox__box--checkin, .searchbox__box--checkout')\n        .on('click focus', function(e) {\n          e.preventDefault();\n\n          fp.isOpen = false;\n          fp.open(undefined, this);\n        });\n    }\n\n    setuptPopper(el) {\n      const $html = $(el).find('.searchbox__popup');\n      if ($html.length === 0) {\n        return;\n      }\n\n      tippy(el, {\n        theme: 'awebooking-popup',\n        delay: 0,\n        arrow: true,\n        distance: 0,\n        placement: 'bottom',\n        trigger: 'click',\n        interactive: true,\n        performance: true,\n        hideOnClick: true,\n        animation: 'shift-toward',\n        duration: [150, 150],\n        html: $html[0],\n        popperOptions: { modifiers: {\n            hide: { enabled: false },\n            preventOverflow: { enabled: false },\n          }}\n      });\n\n      return el._tippy;\n    }\n  }\n\n  $(function () {\n    $('.searchbox').each(function () {\n      new SearchForm(this);\n    });\n  });\n\n})(jQuery, window.ko, window.awebooking);\n"],"file":"search-form.js"}