{"version":3,"names":[],"mappings":"","sources":["search-form.js"],"sourcesContent":["(function ($, ko, plugin) {\r\n  'use strict';\r\n\r\n  function formatDate(date, format) {\r\n    const _date = plugin.utils.dates.parse(date, format || plugin.i18n.dateFormat);\r\n\r\n    if (!_date) {\r\n      return '';\r\n    }\r\n\r\n    return plugin.utils.dates.format(_date, format || plugin.i18n.dateFormat);\r\n  }\r\n\r\n  function SearchFormModel(data = {}) {\r\n    this.adults    = ko.observable(data.adults || 1);\r\n    this.children = ko.observable(data.children || 0);\r\n    this.infants  = ko.observable(data.infants || 0);\r\n    this.checkIn  = ko.observable(data.checkIn || '');\r\n    this.checkOut = ko.observable(data.checkOut || '');\r\n\r\n    this.checkInDate = ko.computed(() => {\r\n      return formatDate(this.checkIn(), 'Y-m-d');\r\n    });\r\n\r\n    this.checkOutDate = ko.computed(() => {\r\n      return formatDate(this.checkOut(), 'Y-m-d');\r\n    });\r\n\r\n    this.checkInFormatted = ko.computed(() => {\r\n      return formatDate(this.checkIn());\r\n    });\r\n\r\n    this.checkOutFormatted = ko.computed(() => {\r\n      return formatDate(this.checkOut());\r\n    });\r\n  }\r\n\r\n  class SearchForm {\r\n    constructor (el) {\r\n      const self = this;\r\n\r\n      this.$el = $(el);\r\n\r\n      this.model = new SearchFormModel({\r\n        adults: this.$el.find('input[name=\"adults\"]').val(),\r\n        children: this.$el.find('input[name=\"children\"]').val(),\r\n        infants: this.$el.find('input[name=\"infants\"]').val(),\r\n        checkIn: this.$el.find('input[name=\"check_in\"]').val(),\r\n        checkOut: this.$el.find('input[name=\"check_out\"]').val(),\r\n      });\r\n\r\n      ko.applyBindings(this.model, el);\r\n\r\n      let $rangepicker = this.$el.find('[data-hotel=\"rangepicker\"]');\r\n      if ($rangepicker.length === 0) {\r\n        $rangepicker = $('<input type=\"text\" data-hotel=\"rangepicker\"/>').appendTo(this.$el);\r\n      }\r\n\r\n      const fp = awebooking.datepicker($rangepicker[0], {\r\n        mode: 'range',\r\n        altInput: false,\r\n        clickOpens: false,\r\n        closeOnSelect: true,\r\n\r\n        onReady() {\r\n          this.config.ignoredFocusElements.push($('.searchbox__box--checkin', self.$el)[0]);\r\n          this.config.ignoredFocusElements.push($('.searchbox__box--checkout', self.$el)[0]);\r\n        },\r\n\r\n        onChange: (dates) => {\r\n          if (dates.length === 0) {\r\n            this.model.checkIn(null);\r\n            this.model.checkIn(null);\r\n          } else if (dates.length === 1) {\r\n            this.model.checkIn(dates[0]);\r\n            this.model.checkOut(null);\r\n          } else {\r\n            this.model.checkIn(dates[0]);\r\n            this.model.checkOut(dates[1]);\r\n          }\r\n        },\r\n\r\n        onPreCalendarPosition() {\r\n          fp._positionElement = $('.searchbox__box--checkout', self.$el)[0];\r\n          setTimeout(() => { this._positionElement = this._input; }, 0);\r\n        },\r\n      });\r\n\r\n      $('.searchbox__box--checkin, .searchbox__box--checkout', this.$el)\r\n        .on('click focus', function(e) {\r\n          e.preventDefault();\r\n\r\n          fp.isOpen = false;\r\n          fp.open(undefined, this);\r\n        });\r\n\r\n      $('.searchbox__box', this.$el).each((i, box) => {\r\n        $(box).data('popup', this.setuptPopper(box));\r\n      });\r\n    }\r\n\r\n    setuptPopper(el) {\r\n      const $html = $(el).find('.searchbox__popup');\r\n\r\n      if ($html.length === 0) {\r\n        return;\r\n      }\r\n\r\n      plugin.utils.dropdown($(el).find('.searchbox__box-wrap'), {\r\n        drop: '.searchbox__popup',\r\n      });\r\n    }\r\n  }\r\n\r\n  $(function () {\r\n    $('.searchbox').each(function () {\r\n      new SearchForm(this);\r\n    });\r\n  });\r\n\r\n})(jQuery, window.ko, window.awebooking);\r\n"],"file":"search-form.js"}