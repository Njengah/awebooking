{"version":3,"file":"search-form.js","sources":["assets/babel/search-form.js"],"sourcesContent":["import ko from 'ko'\nimport $ from 'jquery'\nimport plugin from 'awebooking'\n\nfunction formatDate(date, format) {\n  const _date = plugin.utils.dates.parse(date, 'Y-m-d');\n\n  if (!_date) {\n    return '';\n  }\n\n  return plugin.utils.dates.format(_date, format || plugin.i18n.dateFormat);\n}\n\nfunction SearchFormModel(data = {}) {\n  this.adults    = ko.observable(data.adults || 1);\n  this.children = ko.observable(data.children || 0);\n  this.infants  = ko.observable(data.infants || 0);\n  this.checkIn  = ko.observable(data.checkIn || '');\n  this.checkOut = ko.observable(data.checkOut || '');\n\n  this.checkInDate = ko.computed(() => {\n    return formatDate(this.checkIn(), 'Y-m-d');\n  });\n\n  this.checkOutDate = ko.computed(() => {\n    return formatDate(this.checkOut(), 'Y-m-d');\n  });\n\n  this.checkInFormatted = ko.computed(() => {\n    return formatDate(this.checkIn());\n  });\n\n  this.checkOutFormatted = ko.computed(() => {\n    return formatDate(this.checkOut());\n  });\n}\n\nclass SearchForm {\n  constructor (el) {\n    const self = this;\n\n    this.$el = $(el);\n\n    this.model = new SearchFormModel({\n      adults: this.$el.find('input[name=\"adults\"]').val(),\n      children: this.$el.find('input[name=\"children\"]').val(),\n      infants: this.$el.find('input[name=\"infants\"]').val(),\n      checkIn: this.$el.find('input[name=\"check_in\"]').val(),\n      checkOut: this.$el.find('input[name=\"check_out\"]').val(),\n    });\n\n    ko.applyBindings(this.model, el);\n\n    let $rangepicker = this.$el.find('[data-hotel=\"rangepicker\"]');\n    if ($rangepicker.length === 0) {\n      $rangepicker = $('<input type=\"text\" data-hotel=\"rangepicker\"/>').appendTo(this.$el);\n    }\n\n    const fp = awebooking.datepicker($rangepicker[0], {\n      mode: 'range',\n      altInput: false,\n      clickOpens: false,\n      closeOnSelect: true,\n\n      onReady() {\n        this.config.ignoredFocusElements.push($('.searchbox__box--checkin', self.$el)[0]);\n        this.config.ignoredFocusElements.push($('.searchbox__box--checkout', self.$el)[0]);\n      },\n\n      onChange: (dates) => {\n        if (dates.length === 0) {\n          this.model.checkIn(null);\n          this.model.checkIn(null);\n        } else if (dates.length === 1) {\n          this.model.checkIn(dates[0]);\n          this.model.checkOut(null);\n        } else {\n          this.model.checkIn(dates[0]);\n          this.model.checkOut(dates[1]);\n        }\n      },\n\n      onPreCalendarPosition() {\n        fp._positionElement = $('.searchbox__box--checkout', self.$el)[0];\n        setTimeout(() => { this._positionElement = this._input; }, 0);\n      },\n    });\n\n    $('.searchbox__box--checkin, .searchbox__box--checkout', this.$el)\n      .on('click focus', function(e) {\n        e.preventDefault();\n\n        fp.isOpen = false;\n        fp.open(undefined, this);\n      });\n\n    $('.searchbox__box', this.$el).each((i, box) => {\n      $(box).data('popup', this.setuptPopper(box));\n    });\n  }\n\n  setuptPopper(el) {\n    const $html = $(el).find('.searchbox__popup');\n\n    if ($html.length === 0) {\n      return;\n    }\n\n    plugin.utils.dropdown($(el).find('.searchbox__box-wrap'), {\n      drop: '.searchbox__popup',\n      display: 'static',\n    });\n  }\n}\n\n$(function () {\n  $('.searchbox').each(function () {\n    new SearchForm(this);\n  });\n});\n"],"names":["formatDate","date","format","_date","plugin","utils","dates","parse","i18n","dateFormat","SearchFormModel","data","adults","ko","observable","children","infants","checkIn","checkOut","checkInDate","computed","checkOutDate","checkInFormatted","checkOutFormatted","SearchForm","el","self","$el","$","model","find","val","applyBindings","$rangepicker","length","appendTo","fp","awebooking","datepicker","mode","altInput","clickOpens","closeOnSelect","onReady","config","ignoredFocusElements","push","onChange","onPreCalendarPosition","_positionElement","setTimeout","_input","on","e","preventDefault","isOpen","open","undefined","each","i","box","setuptPopper","$html","dropdown","drop","display"],"mappings":"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"}