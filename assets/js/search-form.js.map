{"version":3,"names":[],"mappings":"","sources":["search-form.js"],"sourcesContent":["(function ($, ko, plugin) {\n  'use strict';\n\n  function formatDate(date, format) {\n    const _date = flatpickr.parseDate(date);\n\n    if (!_date) {\n      return '';\n    }\n\n    return flatpickr.formatDate(_date, format || plugin.i18n.dateFormat);\n  }\n\n  function SearchFormModel(data = {}) {\n    this.adults    = ko.observable(data.adults || 1);\n    this.children = ko.observable(data.children || 0);\n    this.infants  = ko.observable(data.infants || 0);\n    this.checkIn  = ko.observable(data.checkIn || '');\n    this.checkOut = ko.observable(data.checkOut || '');\n\n    this.checkInDate = ko.computed(() => {\n      return formatDate(this.checkIn(), 'Y-m-d');\n    });\n\n    this.checkOutDate = ko.computed(() => {\n      return formatDate(this.checkOut(), 'Y-m-d');\n    });\n\n    this.checkInFormatted = ko.computed(() => {\n      return formatDate(this.checkIn());\n    });\n\n    this.checkOutFormatted = ko.computed(() => {\n      return formatDate(this.checkOut());\n    });\n  }\n\n  class SearchForm {\n    constructor (el) {\n      const self = this;\n\n      this.$el = $(el);\n\n      this.model = new SearchFormModel({\n        adults: this.$el.find('input[name=\"adults\"]').val(),\n        children: this.$el.find('input[name=\"children\"]').val(),\n        infants: this.$el.find('input[name=\"infants\"]').val(),\n        checkIn: this.$el.find('input[name=\"check_in\"]').val(),\n        checkOut: this.$el.find('input[name=\"check_out\"]').val(),\n      });\n\n      ko.applyBindings(this.model, el);\n\n      let $rangepicker = this.$el.find('[data-hotel=\"rangepicker\"]');\n      if ($rangepicker.length === 0) {\n        $rangepicker = $('<input type=\"text\" data-hotel=\"rangepicker\"/>').appendTo(this.$el);\n      }\n\n      const fp = awebooking.datepicker($rangepicker[0], {\n        mode: 'range',\n        altInput: false,\n        clickOpens: false,\n        closeOnSelect: true,\n\n        onReady() {\n          this.config.ignoredFocusElements.push($('.searchbox__box--checkin', self.$el)[0]);\n          this.config.ignoredFocusElements.push($('.searchbox__box--checkout', self.$el)[0]);\n        },\n\n        onChange: (dates) => {\n          if (dates.length === 0) {\n            this.model.checkIn(null);\n            this.model.checkIn(null);\n          } else if (dates.length === 1) {\n            this.model.checkIn(dates[0]);\n            this.model.checkOut(null);\n          } else {\n            this.model.checkIn(dates[0]);\n            this.model.checkOut(dates[1]);\n          }\n        },\n\n        onPreCalendarPosition() {\n          fp._positionElement = $('.searchbox__box--checkout', self.$el)[0];\n          setTimeout(() => { this._positionElement = this._input; }, 0);\n        },\n      });\n\n      $('.searchbox__box--checkin, .searchbox__box--checkout', this.$el)\n        .on('click focus', function(e) {\n          e.preventDefault();\n\n          fp.isOpen = false;\n          fp.open(undefined, this);\n        });\n\n      $('.searchbox__box', this.$el).each((i, box) => {\n        $(box).data('popup', this.setuptPopper(box));\n      });\n    }\n\n    setuptPopper(el) {\n      const $html = $(el).find('.searchbox__popup');\n\n      if ($html.length === 0) {\n        return;\n      }\n\n      plugin.utils.dropdown($(el).find('.searchbox__box-wrap'), {\n        dropClass: '.searchbox__popup',\n      });\n    }\n  }\n\n  $(function () {\n    $('.searchbox').each(function () {\n      new SearchForm(this);\n    });\n  });\n\n})(jQuery, window.ko, window.awebooking);\n"],"file":"search-form.js"}