{"version":3,"file":"page-pricing.js","sources":["assets/babel/admin/page-pricing.js"],"sourcesContent":["import $ from 'jquery';\nimport plugin from 'awebooking';\n\nconst DATE_FORMAT  = 'YYYY-MM-DD';\n\nclass PricingScheduler {\n  /**\n   * Constructor.\n   *\n   * @return {void}\n   */\n  constructor() {\n    this.flatpickr = null;\n\n    this.scheduler = new ScheduleCalendar({\n      el: '.scheduler',\n      debug: plugin.debug,\n      granularity: 'daily',\n    });\n\n    this.$dialog = plugin.dialog('#scheduler-form-dialog');\n\n    this.scheduler.on('clear', this.handleClearSelected.bind(this));\n    this.scheduler.on('action:set-price', this.handleSetPrice.bind(this));\n    this.scheduler.on('action:reset-price', this.handleResetPrice.bind(this));\n\n    this.initBulkUpdate();\n  }\n\n  /**\n   * Handle on clear selected.\n   *\n   * @return {void}\n   */\n  handleClearSelected() {\n    window.swal && swal.close();\n\n    if (this.flatpickr) {\n      this.flatpickr.destroy();\n    }\n\n    this.$dialog.dialog('close');\n    $('#js-scheduler-form-controls').html('');\n  }\n\n  /**\n   * Handle set price action.\n   *\n   * @param  {Event}  e\n   * @param  {Object} model\n   * @return {void}\n   */\n  handleSetPrice(e, model) {\n    window.swal && swal.close();\n\n    this.compileHtmlControls('set_price', 0);\n\n    this.$dialog.dialog('open');\n  }\n\n  /**\n   * Handle reset price action.\n   *\n   * @param  {Event}  e\n   * @param  {Object} model\n   * @return {void}\n   */\n  handleResetPrice(e, model) {\n    plugin.confirm(plugin.i18n.warning, () => {\n      const $controls = this.compileHtmlControls('reset_price', 0);\n      $controls.closest('form').submit();\n    });\n  }\n\n  /**\n   * Compile html form controls.\n   *\n   * @param  {string} action\n   * @param  {float}  amount\n   * @return {void}\n   */\n  compileHtmlControls(action, amount) {\n    const model = this.scheduler.model;\n    const template = wp.template('scheduler-pricing-controls');\n\n    let roomtype = {};\n    if (window._listRoomTypes) {\n      roomtype = _.findWhere(window._listRoomTypes, { id: model.get('calendar') });\n    }\n\n    // Destroy flatpickr first.\n    if (this.flatpickr) {\n      this.flatpickr.destroy();\n    }\n\n    // Compile the html template.\n    const $controls = $('#js-scheduler-form-controls').html(template({\n      action:    action,\n      amount:    amount,\n      roomtype:  roomtype,\n      calendar:  model.get('calendar'),\n      endDate:   model.get('endDate').format(DATE_FORMAT),\n      startDate: model.get('startDate').format(DATE_FORMAT),\n    }));\n\n    // Create the flatpickr after.\n    this.flatpickr = flatpickr('#date_start', {\n      dateFormat: 'Y-m-d',\n      plugins: [ new plugin.utils.flatpickrRangePlugin({ input: '#date_end' }) ],\n    });\n\n    return $controls;\n  }\n\n  /**\n   * Handle bulk update action.\n   */\n  initBulkUpdate() {\n    const $dialog = plugin.dialog('#bulk-update-dialog');\n\n    $('.js-open-bulk-update').on('click', function(e) {\n      e.preventDefault();\n      $dialog.dialog('open');\n    });\n\n    flatpickr('#bulk_date_start', {\n      mode: 'range',\n      dateFormat: 'Y-m-d',\n      showMonths: 2,\n      plugins: [ new plugin.utils.flatpickrRangePlugin({ input: '#bulk_date_end' }) ],\n    });\n  }\n}\n\n/**\n * Document ready!\n *\n * @return {void}\n */\n$(function() {\n  new PricingScheduler();\n});\n"],"names":["DATE_FORMAT","PricingScheduler","flatpickr","scheduler","ScheduleCalendar","el","debug","plugin","granularity","$dialog","dialog","on","handleClearSelected","bind","handleSetPrice","handleResetPrice","initBulkUpdate","window","swal","close","destroy","$","html","e","model","compileHtmlControls","confirm","i18n","warning","$controls","closest","submit","action","amount","template","wp","roomtype","_listRoomTypes","_","findWhere","id","get","calendar","endDate","format","startDate","dateFormat","plugins","utils","flatpickrRangePlugin","input","preventDefault","mode","showMonths"],"mappings":"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"}