{"version":3,"file":"page-pricing.js","sources":["assets/babel/admin/page-pricing.js"],"sourcesContent":["import $ from 'jquery';\nimport plugin from 'awebooking';\n\nconst DATE_FORMAT  = 'YYYY-MM-DD';\n\nclass PricingScheduler {\n  /**\n   * Constructor.\n   *\n   * @return {void}\n   */\n  constructor() {\n    this.flatpickr = null;\n\n    this.scheduler = new ScheduleCalendar({\n      el: '.scheduler',\n      debug: plugin.debug,\n      granularity: 'daily',\n    });\n\n    this.$dialog = plugin.dialog('#scheduler-form-dialog');\n\n    this.scheduler.on('clear', this.handleClearSelected.bind(this));\n    this.scheduler.on('action:set-price', this.handleSetPrice.bind(this));\n    this.scheduler.on('action:reset-price', this.handleResetPrice.bind(this));\n\n    this.initBulkUpdate();\n  }\n\n  /**\n   * Handle on clear selected.\n   *\n   * @return {void}\n   */\n  handleClearSelected() {\n    window.swal && swal.close();\n\n    if (this.flatpickr) {\n      this.flatpickr.destroy();\n    }\n\n    this.$dialog.dialog('close');\n    $('#js-scheduler-form-controls').html('');\n  }\n\n  /**\n   * Handle set price action.\n   *\n   * @param  {Event}  e\n   * @param  {Object} model\n   * @return {void}\n   */\n  handleSetPrice(e, model) {\n    window.swal && swal.close();\n\n    this.compileHtmlControls('set_price', 0);\n\n    this.$dialog.dialog('open');\n  }\n\n  /**\n   * Handle reset price action.\n   *\n   * @param  {Event}  e\n   * @param  {Object} model\n   * @return {void}\n   */\n  handleResetPrice(e, model) {\n    plugin.confirm(plugin.i18n.warning, () => {\n      const $controls = this.compileHtmlControls('reset_price', 0);\n      $controls.closest('form').submit();\n    });\n  }\n\n  /**\n   * Compile html form controls.\n   *\n   * @param  {string} action\n   * @param  {float}  amount\n   * @return {void}\n   */\n  compileHtmlControls(action, amount) {\n    const model = this.scheduler.model;\n    const template = wp.template('scheduler-pricing-controls');\n\n    let roomtype = {};\n    if (window._listRoomTypes) {\n      roomtype = _.findWhere(window._listRoomTypes, { id: model.get('calendar') });\n    }\n\n    // Destroy flatpickr first.\n    if (this.flatpickr) {\n      this.flatpickr.destroy();\n    }\n\n    // Compile the html template.\n    const $controls = $('#js-scheduler-form-controls').html(template({\n      action:    action,\n      amount:    amount,\n      roomtype:  roomtype,\n      calendar:  model.get('calendar'),\n      endDate:   model.get('endDate').format(DATE_FORMAT),\n      startDate: model.get('startDate').format(DATE_FORMAT),\n    }));\n\n    // Create the flatpickr after.\n    this.flatpickr = flatpickr('#date_start', {\n      dateFormat: 'Y-m-d',\n      plugins: [ new plugin.utils.flatpickrRangePlugin({ input: '#date_end' }) ],\n    });\n\n    return $controls;\n  }\n\n  /**\n   * Handle bulk update action.\n   */\n  initBulkUpdate() {\n    const $dialog = plugin.dialog('#bulk-update-dialog');\n\n    $('.js-open-bulk-update').on('click', function(e) {\n      e.preventDefault();\n      $dialog.dialog('open');\n    });\n\n    flatpickr('#bulk_date_start', {\n      mode: 'range',\n      dateFormat: 'Y-m-d',\n      showMonths: plugin.isMobile() ? 1 : 2,\n      plugins: [ new plugin.utils.flatpickrRangePlugin({ input: '#bulk_date_end' }) ],\n    });\n  }\n}\n\n/**\n * Document ready!\n *\n * @return {void}\n */\n$(function() {\n  new PricingScheduler();\n});\n"],"names":["DATE_FORMAT","PricingScheduler","flatpickr","scheduler","ScheduleCalendar","el","debug","plugin","granularity","$dialog","dialog","on","handleClearSelected","bind","handleSetPrice","handleResetPrice","initBulkUpdate","window","swal","close","destroy","$","html","e","model","compileHtmlControls","confirm","i18n","warning","$controls","closest","submit","action","amount","template","wp","roomtype","_listRoomTypes","_","findWhere","id","get","calendar","endDate","format","startDate","dateFormat","plugins","utils","flatpickrRangePlugin","input","preventDefault","mode","showMonths","isMobile"],"mappings":"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"}