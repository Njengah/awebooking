{"version":3,"names":[],"mappings":"","sources":["admin/settings.js"],"sourcesContent":["(function($, plugin) {\r\n  'use strict';\r\n\r\n  const settings = window._awebookingSettings || {};\r\n\r\n  /**\r\n   * Handle leaving using window.onbeforeunload.\r\n   *\r\n   * @return {void}\r\n   */\r\n  function handleLeaving() {\r\n    let changed = false;\r\n\r\n    // Set the changed if any controls fire change.\r\n    $('input, textarea, select').on( 'change', function() {\r\n      changed = true;\r\n    });\r\n\r\n    $('.awebooking-settings')\r\n      .on('click', '.nav-tab-wrapper a', function() {\r\n        if (changed) {\r\n          window.onbeforeunload = function() {\r\n            return settings.i18n.nav_warning;\r\n          };\r\n        } else {\r\n          window.onbeforeunload = null;\r\n        }\r\n      })\r\n      .on('click', '.submit button', function() {\r\n        window.onbeforeunload = null;\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Init the datepicker.\r\n   *\r\n   * @return {void}\r\n   */\r\n  function initDatepicker() {\r\n    $('#display_datepicker_disabledates').flatpickr({\r\n      mode: 'multiple',\r\n      dateFormat: 'Y-m-d'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Setup input table bindings.\r\n   *\r\n   * @return {void}\r\n   */\r\n  function setupInputTable() {\r\n    const $table = $('.awebooking-input-table');\r\n\r\n    let shifted, controlled, hasFocus;\r\n    shifted = controlled = hasFocus = false;\r\n\r\n    $(document).bind('keyup keydown', function (e) {\r\n      shifted = e.shiftKey;\r\n      controlled = e.ctrlKey || e.metaKey;\r\n    });\r\n\r\n    const handleClickInputTable = function(el, e) {\r\n      var $elRow = $(el).closest('tr');\r\n      var $elTable = $(el).closest('table, tbody');\r\n\r\n      if ((e.type === 'focus' && hasFocus !== $elRow.index()) || (e.type === 'click' && $(el).is(':focus'))) {\r\n        hasFocus = $elRow.index();\r\n\r\n        if (!shifted && !controlled) {\r\n          $('tr', $elTable).removeClass('current').removeClass('last-selected');\r\n          $elRow.addClass('current').addClass('last-selected');\r\n        } else if (shifted) {\r\n          $('tr', $elTable).removeClass('current');\r\n          $elRow.addClass('selected-now').addClass('current');\r\n\r\n          if ($('tr.last-selected', $elTable).length > 0) {\r\n            if ($elRow.index() > $('tr.last-selected', $elTable).index()) {\r\n              $('tr', $elTable).slice($('tr.last-selected', $elTable).index(), $elRow.index()).addClass('current');\r\n            } else {\r\n              $('tr', $elTable).slice($elRow.index(), $('tr.last-selected', $elTable).index() + 1).addClass('current');\r\n            }\r\n          }\r\n\r\n          $('tr', $elTable).removeClass('last-selected');\r\n          $elRow.addClass('last-selected');\r\n        } else {\r\n          $('tr', $elTable).removeClass('last-selected');\r\n          if (controlled && $(el).closest('tr').is('.current')) {\r\n            $elRow.removeClass('current');\r\n          } else {\r\n            $elRow.addClass('current').addClass('last-selected');\r\n          }\r\n        }\r\n\r\n        $('tr', $elTable).removeClass('selected-now');\r\n      }\r\n    };\r\n\r\n    const handleRemoveRows = function (el, e) {\r\n      var $tbody = $(el).closest('table').find('tbody');\r\n\r\n      if ($tbody.find('tr.current').length > 0) {\r\n        var $current = $tbody.find('tr.current');\r\n\r\n        $current.each(function () {\r\n          $(this).remove();\r\n        });\r\n      }\r\n    };\r\n\r\n    $table\r\n      .on('blur', 'input', () => {\r\n        hasFocus = false;\r\n      })\r\n      .on('focus click', 'input', function (e) {\r\n        handleClickInputTable(this, e);\r\n      })\r\n      .on('click', '.remove_rows', function (e) {\r\n        e.preventDefault();\r\n        handleRemoveRows(this, e);\r\n      });\r\n  }\r\n\r\n  function setupInputTableSortable() {\r\n    /*$('.wc_input_table.sortable tbody').sortable({\r\n      items: 'tr',\r\n      cursor: 'move',\r\n      axis: 'y',\r\n      scrollSensitivity: 40,\r\n      forcePlaceholderSize: true,\r\n      helper: 'clone',\r\n      opacity: 0.65,\r\n      placeholder: 'wc-metabox-sortable-placeholder',\r\n      start: function (event, ui) {\r\n        ui.item.css('background-color', '#f6f6f6');\r\n      },\r\n      stop: function (event, ui) {\r\n        ui.item.removeAttr('style');\r\n      }\r\n    });\r\n\r\n    // Focus on inputs within the table if clicked instead of trying to sort.\r\n    $('.wc_input_table.sortable tbody input').on('click', function () {\r\n      $(this).focus();\r\n    });*/\r\n  }\r\n\r\n  /** Document ready */\r\n  $(function() {\r\n    handleLeaving();\r\n    initDatepicker();\r\n\r\n    setupInputTable();\r\n    // setupInputTableSortable();\r\n  });\r\n\r\n})(jQuery, window.awebooking);\r\n"],"file":"settings.js"}