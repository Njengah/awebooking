{"version":3,"file":"page-calendar.js","sources":["assets/babel/admin/page-calendar.js"],"sourcesContent":["import $ from 'jquery';\nimport plugin from 'awebooking';\n\nconst DATE_FORMAT  = 'YYYY-MM-DD';\n\nclass BookingScheduler {\n  /**\n   * Constructor.\n   *\n   * @return {void}\n   */\n  constructor() {\n    const self = this;\n\n    this.initBulkUpdate();\n\n    this.scheduler = new ScheduleCalendar({\n      el: '.scheduler',\n      debug: plugin.debug,\n      granularity: 'nightly',\n    });\n\n    this.scheduler.on('clear', this.handleClearSelected.bind(this));\n    this.scheduler.on('action:block', this.handleBlockRoom.bind(this));\n    this.scheduler.on('action:unblock', this.handleUnblockRoom.bind(this));\n\n    $('.js-unlock-period').on('click', function(e) {\n      e.preventDefault();\n      const $el = $(this);\n\n      self.scheduler.model.set('calendar', $el.data('room'));\n      self.scheduler.model.set('startDate', moment($el.data('startDate')));\n      self.scheduler.model.set('endDate', moment($el.data('endDate')));\n\n      self.scheduler.trigger('action:unblock');\n    });\n\n    $('.scheduler__state-event, .scheduler__booking-event').each(function() {\n      self.setupEventPopper(this);\n    });\n  }\n\n  /**\n   * Handle on clear selected.\n   *\n   * @return {void}\n   */\n  handleClearSelected() {\n    window.swal && swal.close();\n  }\n\n  /**\n   * Handle set price action.\n   *\n   * @param  {Event}  e\n   * @param  {Object} model\n   * @return {void}\n   */\n  handleBlockRoom(e, model) {\n    plugin.confirm(plugin.i18n.warning, () => {\n      const $controls = this.compileHtmlControls('block', model);\n      $controls.closest('form').submit();\n    });\n  }\n\n  /**\n   * Handle reset price action.\n   *\n   * @param  {Event}  e\n   * @param  {Object} model\n   * @return {void}\n   */\n  handleUnblockRoom(e, model) {\n    plugin.confirm(plugin.i18n.warning, () => {\n      const $controls = this.compileHtmlControls('unblock', model);\n      $controls.closest('form').submit();\n    });\n  }\n\n  /**\n   * Compile html form controls.\n   *\n   * @param  {string} action\n   * @return {void}\n   */\n  compileHtmlControls(action, model) {\n    const template = wp.template('scheduler-pricing-controls');\n\n    if (! model) {\n      model = this.scheduler.model;\n    }\n\n    const data = {\n      action:    action,\n      endDate:   model.get('endDate').format(DATE_FORMAT),\n      startDate: model.get('startDate').format(DATE_FORMAT),\n      calendar:  model.get('calendar'),\n    };\n\n    return $('#js-scheduler-form-controls').html(template(data));\n  }\n\n  /**\n   * Setup event popper.\n   *\n   * @param  {Object} el\n   * @return {void}\n   */\n  setupEventPopper(el) {\n    const $html = $(el).find('.js-tippy-html');\n\n    tippy(el, {\n      theme: 'booking-popup',\n      delay: 150,\n      arrow: true,\n      distance: 0,\n      maxWidth: '500px',\n      placement: 'bottom',\n      trigger: 'mouseenter focus',\n      interactive: true,\n      performance: true,\n      hideOnClick: false,\n      animation: 'shift-toward',\n      duration: [150, 150],\n      html: $html.length ? $html[0] : false,\n      popperOptions: { modifiers: {\n          hide: { enabled: false },\n          preventOverflow: { enabled: false },\n        }}\n    });\n\n    return el._tippy;\n  }\n\n  /**\n   * Handle bulk update action.\n   */\n  initBulkUpdate() {\n    const $dialog = plugin.dialog('#bulk-update-dialog');\n\n    $('.js-open-bulk-update').on('click', function(e) {\n      e.preventDefault();\n      $dialog.dialog('open');\n    });\n\n    flatpickr('#bulk_date_start', {\n      mode: 'range',\n      dateFormat: 'Y-m-d',\n      showMonths: plugin.isMobile() ? 1 : 2,\n      plugins: [ new plugin.utils.flatpickrRangePlugin({ input: '#bulk_date_end' }) ],\n    });\n  }\n}\n\n/**\n * Document ready!\n *\n * @return {void}\n */\n$(function() {\n  new BookingScheduler();\n});\n"],"names":["DATE_FORMAT","BookingScheduler","self","initBulkUpdate","scheduler","ScheduleCalendar","el","debug","plugin","granularity","on","handleClearSelected","bind","handleBlockRoom","handleUnblockRoom","$","e","preventDefault","$el","model","set","data","moment","trigger","each","setupEventPopper","window","swal","close","confirm","i18n","warning","$controls","compileHtmlControls","closest","submit","action","template","wp","endDate","get","format","startDate","calendar","html","$html","find","tippy","theme","delay","arrow","distance","maxWidth","placement","interactive","performance","hideOnClick","animation","duration","length","popperOptions","modifiers","hide","enabled","preventOverflow","_tippy","$dialog","dialog","flatpickr","mode","dateFormat","showMonths","isMobile","plugins","utils","flatpickrRangePlugin","input"],"mappings":"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"}