{"version":3,"file":"page-calendar.js","sources":["assets/babel/admin/page-calendar.js"],"sourcesContent":["import $ from 'jquery';\nimport plugin from 'awebooking';\n\nconst DATE_FORMAT  = 'YYYY-MM-DD';\n\nclass BookingScheduler {\n  /**\n   * Constructor.\n   *\n   * @return {void}\n   */\n  constructor() {\n    const self = this;\n\n    this.initBulkUpdate();\n\n    this.scheduler = new ScheduleCalendar({\n      el: '.scheduler',\n      debug: plugin.debug,\n      granularity: 'nightly',\n    });\n\n    this.scheduler.on('clear', this.handleClearSelected.bind(this));\n    this.scheduler.on('action:block', this.handleBlockRoom.bind(this));\n    this.scheduler.on('action:unblock', this.handleUnblockRoom.bind(this));\n\n    $('.js-unlock-period').on('click', function(e) {\n      e.preventDefault();\n      const $el = $(this);\n\n      self.scheduler.model.set('calendar', $el.data('room'));\n      self.scheduler.model.set('startDate', moment($el.data('startDate')));\n      self.scheduler.model.set('endDate', moment($el.data('endDate')));\n\n      self.scheduler.trigger('action:unblock');\n    });\n\n    $('.scheduler__state-event, .scheduler__booking-event').each(function() {\n      self.setupEventPopper(this);\n    });\n  }\n\n  /**\n   * Handle on clear selected.\n   *\n   * @return {void}\n   */\n  handleClearSelected() {\n    window.swal && swal.close();\n  }\n\n  /**\n   * Handle set price action.\n   *\n   * @param  {Event}  e\n   * @param  {Object} model\n   * @return {void}\n   */\n  handleBlockRoom(e, model) {\n    plugin.confirm(plugin.i18n.warning, () => {\n      const $controls = this.compileHtmlControls('block', model);\n      $controls.closest('form').submit();\n    });\n  }\n\n  /**\n   * Handle reset price action.\n   *\n   * @param  {Event}  e\n   * @param  {Object} model\n   * @return {void}\n   */\n  handleUnblockRoom(e, model) {\n    plugin.confirm(plugin.i18n.warning, () => {\n      const $controls = this.compileHtmlControls('unblock', model);\n      $controls.closest('form').submit();\n    });\n  }\n\n  /**\n   * Compile html form controls.\n   *\n   * @param  {string} action\n   * @return {void}\n   */\n  compileHtmlControls(action, model) {\n    const template = wp.template('scheduler-pricing-controls');\n\n    if (! model) {\n      model = this.scheduler.model;\n    }\n\n    const data = {\n      action:    action,\n      endDate:   model.get('endDate').format(DATE_FORMAT),\n      startDate: model.get('startDate').format(DATE_FORMAT),\n      calendar:  model.get('calendar'),\n    };\n\n    return $('#js-scheduler-form-controls').html(template(data));\n  }\n\n  /**\n   * Setup event popper.\n   *\n   * @param  {Object} el\n   * @return {void}\n   */\n  setupEventPopper(el) {\n    const $html = $(el).find('.js-tippy-html');\n\n    tippy(el, {\n      theme: 'booking-popup',\n      delay: 150,\n      arrow: true,\n      distance: 0,\n      maxWidth: '500px',\n      placement: 'bottom',\n      trigger: 'mouseenter focus',\n      interactive: true,\n      performance: true,\n      hideOnClick: false,\n      animation: 'shift-toward',\n      duration: [150, 150],\n      html: $html.length ? $html[0] : false,\n      popperOptions: { modifiers: {\n          hide: { enabled: false },\n          preventOverflow: { enabled: false },\n        }}\n    });\n\n    return el._tippy;\n  }\n\n  /**\n   * Handle bulk update action.\n   */\n  initBulkUpdate() {\n    const $dialog = plugin.dialog('#bulk-update-dialog');\n\n    $('.js-open-bulk-update').on('click', function(e) {\n      e.preventDefault();\n      $dialog.dialog('open');\n    });\n\n    flatpickr('#bulk_date_start', {\n      mode: 'range',\n      dateFormat: 'Y-m-d',\n      showMonths: plugin.isMobile() ? 1 : 2,\n      plugins: [ new plugin.utils.flatpickrRangePlugin({ input: '#bulk_date_end' }) ],\n    });\n  }\n}\n\n/**\n * Document ready!\n *\n * @return {void}\n */\n$(function() {\n  new BookingScheduler();\n});\n"],"names":["DATE_FORMAT","BookingScheduler","self","initBulkUpdate","scheduler","ScheduleCalendar","el","debug","plugin","granularity","on","handleClearSelected","bind","handleBlockRoom","handleUnblockRoom","$","e","preventDefault","$el","model","set","data","moment","trigger","each","setupEventPopper","window","swal","close","confirm","i18n","warning","$controls","compileHtmlControls","closest","submit","action","template","wp","endDate","get","format","startDate","calendar","html","$html","find","tippy","theme","delay","arrow","distance","maxWidth","placement","interactive","performance","hideOnClick","animation","duration","length","popperOptions","modifiers","hide","enabled","preventOverflow","_tippy","$dialog","dialog","flatpickr","mode","dateFormat","showMonths","isMobile","plugins","utils","flatpickrRangePlugin","input"],"mappings":"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"}