{"version":3,"file":"schedule-calendar.js","sources":["assets/babel/admin/schedule-calendar.js"],"sourcesContent":["(function($, flatpickr, moment) {\n  'use strict';\n\n  let COLUMN_WIDTH = 60;\n  const DATE_FORMAT  = 'YYYY-MM-DD';\n\n  const Selection = Backbone.Model.extend({\n    defaults: {\n      endDate: null,\n      startDate: null,\n      calendar: null,\n    },\n\n    clear() {\n      this.clearSelectedDate(null);\n    },\n\n    isValid() {\n      if (! this.has('calendar') || this.get('calendar') < 1) {\n        return false;\n      }\n\n      return this.getNights() >= 0;\n    },\n\n    clearSelectedDate(calendar) {\n      this.set({ startDate: null, endDate: null });\n\n      this.set('calendar', calendar);\n\n      this.trigger('clear_dates');\n    },\n\n    getNights() {\n      if (! this.has('endDate') || ! this.has('startDate')) {\n        return -1;\n      }\n\n      return this.get('endDate').diff(this.get('startDate'), 'days');\n    }\n  });\n\n  const ScheduleCalendar = Backbone.View.extend({\n    options: {\n      debug: false,\n      marker: '.scheduler__marker',\n      popper: '.scheduler__popper > .scheduler__actions',\n      granularity: 'nightly', // 'daily'\n    },\n\n    events: {\n      'click      .scheduler__body .scheduler__date': 'setSelectionDate',\n      'mouseenter .scheduler__body .scheduler__date': 'drawMarkerOnHover',\n    },\n\n    initialize(options) {\n      this.options = _.defaults(options || {}, this.options);\n      this.model = new Selection;\n\n      const testColumnWith = this.$el.find('.scheduler__column').first().outerWidth();\n      if (testColumnWith > COLUMN_WIDTH) {\n        COLUMN_WIDTH = testColumnWith;\n      }\n\n      // Handle click action before setup popper.\n      this.$el.find('.scheduler__actions [data-schedule-action]').on('click', this.handleClickAction.bind(this));\n\n      this.$marker = this.$el.find(this.options.marker);\n      this.$marker.hide();\n\n      this.setupPopper();\n      this.popper = this.$marker[0]._tippy;\n\n      if (window.Waypoint) {\n        this.setupLabelAnimate();\n      }\n\n      $(document).on('keyup', this.onKeyup.bind(this));\n      this.listenTo(this.model, 'change:startDate change:endDate', this.setMarkerPosition);\n      this.listenTo(this.model, 'clear_dates', this.onClearSelectedDates);\n\n      if (this.options.debug) {\n        this.listenTo(this.model, 'change', this.debug);\n      }\n\n      this.$el.data('scheduler', this);\n    },\n\n    debug () {\n      if (this.model.has('startDate') && this.model.has('endDate')) {\n        console.log(this.model.get('calendar'), this.model.get('startDate').format(DATE_FORMAT) + ' - ' + this.model.get('endDate').format(DATE_FORMAT));\n      } else if (this.model.has('startDate')) {\n        console.log(this.model.get('calendar'), this.model.get('startDate').format(DATE_FORMAT) + ' - null');\n      } else if(this.model.has('endDate')) {\n        console.log(this.model.get('calendar'), 'null' + ' - ' + this.model.get('endDate').format(DATE_FORMAT));\n      } else {\n        console.log('null - null');\n      }\n    },\n\n    onKeyup(e) {\n      if (e.keyCode == 27) {\n        this.model.clearSelectedDate();\n      }\n    },\n\n    handleClickAction: function(e) {\n      e.preventDefault();\n      const $targetLink = $(e.currentTarget);\n\n      if (! this.model.isValid()) {\n        return false;\n      }\n\n      if (! $targetLink.data('scheduleAction')) {\n        return false;\n      }\n\n      this.trigger('action:' + $targetLink.data('scheduleAction'), e, this.model );\n    },\n\n    onClearSelectedDates() {\n      this.popper.hide();\n\n      this.$marker.find('span').text(0);\n\n      this.trigger('clear');\n    },\n\n    setSelectionDate(e) {\n      const $target = $(e.currentTarget);\n      const setUnit = this.getUnitByElement($target);\n      const clickDate = moment($target.data('date'));\n\n      if (this.model.has('startDate') && this.model.has('endDate')) {\n        this.model.clearSelectedDate(setUnit);\n        return;\n      }\n\n      if (this.model.has('calendar') && setUnit !== this.model.get('calendar')\n          || this.model.has('startDate') && clickDate.isBefore(this.model.get('startDate'), 'day')) {\n        this.model.clearSelectedDate(setUnit);\n      }\n\n      // Set the start date first.\n      if (!this.model.has('startDate') && !this.model.has('endDate')) {\n        this.model.set('calendar', setUnit);\n        this.model.set('startDate', clickDate.clone());\n\n        this.drawMarkerOnHover(e);\n        return;\n      }\n\n      // Require 1 night for granularity by nightly.\n      if ('nightly' == this.options.granularity && clickDate.diff(this.model.get('startDate'), 'days') < 1 ) {\n        return;\n      }\n\n      this.popper.show();\n      this.model.set('endDate', clickDate.clone());\n      this.trigger('apply', this.model, this);\n    },\n\n    setMarkerPosition() {\n      const endDate = this.model.get('endDate');\n      const startDate = this.model.get('startDate');\n\n      if (_.isNull(startDate) && _.isNull(endDate)) {\n        this.$marker.css('width', COLUMN_WIDTH).hide();\n        return;\n      }\n\n      const $startDateEl = this.getElementByDate(\n        this.model.get('calendar'), startDate\n      );\n\n      if (_.isNull(endDate)) {\n        const position = this.getCellPossiton($startDateEl);\n        this.$marker.show().css({ top: position.top, left: position.left });\n      } else {\n        const $endDateEl = this.getElementByDate(this.model.get('calendar'), endDate);\n        this.$marker.css('width', ($endDateEl.index() - $startDateEl.index() + 1) * COLUMN_WIDTH);\n      }\n    },\n\n    drawMarkerOnHover(e) {\n      const $target = $(e.currentTarget);\n      const targetUnit = this.getUnitByElement($target);\n\n      if (!this.model.has('calendar')\n        || this.model.get('calendar') !== targetUnit\n        || !this.model.has('startDate')\n        || this.model.has('startDate') && this.model.has('endDate')) {\n        return;\n      }\n\n      const hoverDate = moment($target.data('date'));\n      const startDate = this.model.get('startDate');\n\n      if (startDate.isSameOrBefore(hoverDate, 'day')) {\n        const $startDateEl = this.getElementByDate(targetUnit, startDate);\n        const days = ($target.index() - $startDateEl.index() + 1);\n\n        this.$marker.css('width', days * COLUMN_WIDTH);\n        this.$marker.find('span').text('daily' == this.options.granularity ? days : days - 1);\n      }\n    },\n\n    getElementByDate(calendar, date) {\n      if (typeof date === 'object') {\n        date = date.format(DATE_FORMAT);\n      }\n\n      return this.$el\n        .find('[data-calendar=\"' + calendar + '\"]')\n        .find('.scheduler__date[data-date=\"' + date + '\"]');\n    },\n\n    getUnitByElement(element) {\n      let calendar = $(element).data('calendar');\n\n      if (typeof calendar === 'undefined') {\n        calendar = $(element).closest('[data-calendar]').data('calendar');\n      }\n\n      calendar = parseInt(calendar, 10);\n      return ! isNaN(calendar) ? calendar : 0;\n    },\n\n    getCellPossiton(element) {\n      const childPos = element.offset();\n      const parentPos = this.$el.find('.scheduler__body').offset();\n\n      return {\n        top: childPos.top - parentPos.top,\n        left: childPos.left - parentPos.left\n      };\n    },\n\n    /**\n     * Setup the Popper.\n     *\n     * @return {void}\n     */\n    setupPopper() {\n      tippy(this.$marker[0], {\n        html: this.$el.find(this.options.popper)[0],\n        theme: 'abrs-tippy',\n        arrow: true,\n        distance: 0,\n        trigger: 'manual',\n        placement: 'bottom',\n        hideOnClick: 'persistent',\n        interactive: true,\n        performance: true,\n        animation: 'shift-away',\n        duration: [150, 150],\n        popperOptions: { modifiers: {\n          hide: { enabled: false },\n          preventOverflow: { enabled: false },\n        }}\n      });\n    },\n\n    /**\n     * Setup the label animate scroll.\n     *\n     * @return {void}\n     */\n    setupLabelAnimate() {\n      const self = this;\n      const $mainContext = self.$el.find('.scheduler__main')[0];\n\n      const onHandler = function(direction) {\n        const $mainLabel    = self.$el.find('.scheduler__aside .scheduler__month-label');\n        const $currentLabel = $(this.element);\n\n        if ('right' === direction) {\n          $currentLabel.attr('data-prev-text', $mainLabel.text());\n          $mainLabel.text($currentLabel.text());\n        } else {\n          $mainLabel.text($currentLabel.data('prevText'));\n          $currentLabel.attr('data-prev-text', '');\n        }\n      };\n\n      self.$el.find('.scheduler__month-label').each(function() {\n        new Waypoint({\n          element: this,\n          context: $mainContext,\n          offset: -50,\n          horizontal: true,\n          handler: onHandler,\n        });\n      });\n    }\n  });\n\n  window.ScheduleCalendar = ScheduleCalendar;\n\n})(jQuery, window.flatpickr, window.moment);\n"],"names":["$","flatpickr","moment","COLUMN_WIDTH","DATE_FORMAT","Selection","Backbone","Model","extend","defaults","endDate","startDate","calendar","clear","clearSelectedDate","isValid","has","get","getNights","set","trigger","diff","ScheduleCalendar","View","options","debug","marker","popper","granularity","events","initialize","_","model","testColumnWith","$el","find","first","outerWidth","on","handleClickAction","bind","$marker","hide","setupPopper","_tippy","window","Waypoint","setupLabelAnimate","document","onKeyup","listenTo","setMarkerPosition","onClearSelectedDates","data","console","log","format","e","keyCode","preventDefault","$targetLink","currentTarget","text","setSelectionDate","$target","setUnit","getUnitByElement","clickDate","isBefore","clone","drawMarkerOnHover","show","isNull","css","$startDateEl","getElementByDate","position","getCellPossiton","top","left","$endDateEl","index","targetUnit","hoverDate","isSameOrBefore","days","date","element","closest","parseInt","isNaN","childPos","offset","parentPos","tippy","html","theme","arrow","distance","placement","hideOnClick","interactive","performance","animation","duration","popperOptions","modifiers","enabled","preventOverflow","self","$mainContext","onHandler","direction","$mainLabel","$currentLabel","attr","each","context","horizontal","handler","jQuery"],"mappings":";;;;;;;;;;;;;;;;;EAAA,CAAC,UAASA,CAAT,EAAYC,SAAZ,EAAuBC,MAAvB,EAA+B;AAC9B;EAEA,MAAIC,YAAY,GAAG,EAAnB;EACA,MAAMC,WAAW,GAAI,YAArB;EAEA,MAAMC,SAAS,GAAGC,QAAQ,CAACC,KAAT,CAAeC,MAAf,CAAsB;EACtCC,IAAAA,QAAQ,EAAE;EACRC,MAAAA,OAAO,EAAE,IADD;EAERC,MAAAA,SAAS,EAAE,IAFH;EAGRC,MAAAA,QAAQ,EAAE;EAHF,KAD4B;EAOtCC,IAAAA,KAPsC,mBAO9B;EACN,WAAKC,iBAAL,CAAuB,IAAvB;EACD,KATqC;EAWtCC,IAAAA,OAXsC,qBAW5B;EACR,UAAI,CAAE,KAAKC,GAAL,CAAS,UAAT,CAAF,IAA0B,KAAKC,GAAL,CAAS,UAAT,IAAuB,CAArD,EAAwD;EACtD,eAAO,KAAP;EACD;;EAED,aAAO,KAAKC,SAAL,MAAoB,CAA3B;EACD,KAjBqC;EAmBtCJ,IAAAA,iBAnBsC,6BAmBpBF,QAnBoB,EAmBV;EAC1B,WAAKO,GAAL,CAAS;EAAER,QAAAA,SAAS,EAAE,IAAb;EAAmBD,QAAAA,OAAO,EAAE;EAA5B,OAAT;EAEA,WAAKS,GAAL,CAAS,UAAT,EAAqBP,QAArB;EAEA,WAAKQ,OAAL,CAAa,aAAb;EACD,KAzBqC;EA2BtCF,IAAAA,SA3BsC,uBA2B1B;EACV,UAAI,CAAE,KAAKF,GAAL,CAAS,SAAT,CAAF,IAAyB,CAAE,KAAKA,GAAL,CAAS,WAAT,CAA/B,EAAsD;EACpD,eAAO,CAAC,CAAR;EACD;;EAED,aAAO,KAAKC,GAAL,CAAS,SAAT,EAAoBI,IAApB,CAAyB,KAAKJ,GAAL,CAAS,WAAT,CAAzB,EAAgD,MAAhD,CAAP;EACD;EAjCqC,GAAtB,CAAlB;EAoCA,MAAMK,gBAAgB,GAAGhB,QAAQ,CAACiB,IAAT,CAAcf,MAAd,CAAqB;EAC5CgB,IAAAA,OAAO,EAAE;EACPC,MAAAA,KAAK,EAAE,KADA;EAEPC,MAAAA,MAAM,EAAE,oBAFD;EAGPC,MAAAA,MAAM,EAAE,0CAHD;EAIPC,MAAAA,WAAW,EAAE,SAJN;;EAAA,KADmC;EAQ5CC,IAAAA,MAAM,EAAE;EACN,sDAAgD,kBAD1C;EAEN,sDAAgD;EAF1C,KARoC;EAa5CC,IAAAA,UAb4C,sBAajCN,OAbiC,EAaxB;EAClB,WAAKA,OAAL,GAAeO,CAAC,CAACtB,QAAF,CAAWe,OAAO,IAAI,EAAtB,EAA0B,KAAKA,OAA/B,CAAf;EACA,WAAKQ,KAAL,GAAa,IAAI3B,SAAJ,EAAb;EAEA,UAAM4B,cAAc,GAAG,KAAKC,GAAL,CAASC,IAAT,CAAc,oBAAd,EAAoCC,KAApC,GAA4CC,UAA5C,EAAvB;;EACA,UAAIJ,cAAc,GAAG9B,YAArB,EAAmC;EACjCA,QAAAA,YAAY,GAAG8B,cAAf;EACD,OAPiB;;;EAUlB,WAAKC,GAAL,CAASC,IAAT,CAAc,4CAAd,EAA4DG,EAA5D,CAA+D,OAA/D,EAAwE,KAAKC,iBAAL,CAAuBC,IAAvB,CAA4B,IAA5B,CAAxE;EAEA,WAAKC,OAAL,GAAe,KAAKP,GAAL,CAASC,IAAT,CAAc,KAAKX,OAAL,CAAaE,MAA3B,CAAf;EACA,WAAKe,OAAL,CAAaC,IAAb;EAEA,WAAKC,WAAL;EACA,WAAKhB,MAAL,GAAc,KAAKc,OAAL,CAAa,CAAb,EAAgBG,MAA9B;;EAEA,UAAIC,MAAM,CAACC,QAAX,EAAqB;EACnB,aAAKC,iBAAL;EACD;;EAED/C,MAAAA,CAAC,CAACgD,QAAD,CAAD,CAAYV,EAAZ,CAAe,OAAf,EAAwB,KAAKW,OAAL,CAAaT,IAAb,CAAkB,IAAlB,CAAxB;EACA,WAAKU,QAAL,CAAc,KAAKlB,KAAnB,EAA0B,iCAA1B,EAA6D,KAAKmB,iBAAlE;EACA,WAAKD,QAAL,CAAc,KAAKlB,KAAnB,EAA0B,aAA1B,EAAyC,KAAKoB,oBAA9C;;EAEA,UAAI,KAAK5B,OAAL,CAAaC,KAAjB,EAAwB;EACtB,aAAKyB,QAAL,CAAc,KAAKlB,KAAnB,EAA0B,QAA1B,EAAoC,KAAKP,KAAzC;EACD;;EAED,WAAKS,GAAL,CAASmB,IAAT,CAAc,WAAd,EAA2B,IAA3B;EACD,KA5C2C;EA8C5C5B,IAAAA,KA9C4C,mBA8CnC;EACP,UAAI,KAAKO,KAAL,CAAWhB,GAAX,CAAe,WAAf,KAA+B,KAAKgB,KAAL,CAAWhB,GAAX,CAAe,SAAf,CAAnC,EAA8D;EAC5DsC,QAAAA,OAAO,CAACC,GAAR,CAAY,KAAKvB,KAAL,CAAWf,GAAX,CAAe,UAAf,CAAZ,EAAwC,KAAKe,KAAL,CAAWf,GAAX,CAAe,WAAf,EAA4BuC,MAA5B,CAAmCpD,WAAnC,IAAkD,KAAlD,GAA0D,KAAK4B,KAAL,CAAWf,GAAX,CAAe,SAAf,EAA0BuC,MAA1B,CAAiCpD,WAAjC,CAAlG;EACD,OAFD,MAEO,IAAI,KAAK4B,KAAL,CAAWhB,GAAX,CAAe,WAAf,CAAJ,EAAiC;EACtCsC,QAAAA,OAAO,CAACC,GAAR,CAAY,KAAKvB,KAAL,CAAWf,GAAX,CAAe,UAAf,CAAZ,EAAwC,KAAKe,KAAL,CAAWf,GAAX,CAAe,WAAf,EAA4BuC,MAA5B,CAAmCpD,WAAnC,IAAkD,SAA1F;EACD,OAFM,MAEA,IAAG,KAAK4B,KAAL,CAAWhB,GAAX,CAAe,SAAf,CAAH,EAA8B;EACnCsC,QAAAA,OAAO,CAACC,GAAR,CAAY,KAAKvB,KAAL,CAAWf,GAAX,CAAe,UAAf,CAAZ,EAAwC,SAAS,KAAT,GAAiB,KAAKe,KAAL,CAAWf,GAAX,CAAe,SAAf,EAA0BuC,MAA1B,CAAiCpD,WAAjC,CAAzD;EACD,OAFM,MAEA;EACLkD,QAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;EACD;EACF,KAxD2C;EA0D5CN,IAAAA,OA1D4C,mBA0DpCQ,CA1DoC,EA0DjC;EACT,UAAIA,CAAC,CAACC,OAAF,IAAa,EAAjB,EAAqB;EACnB,aAAK1B,KAAL,CAAWlB,iBAAX;EACD;EACF,KA9D2C;EAgE5CyB,IAAAA,iBAAiB,EAAE,2BAASkB,CAAT,EAAY;EAC7BA,MAAAA,CAAC,CAACE,cAAF;EACA,UAAMC,WAAW,GAAG5D,CAAC,CAACyD,CAAC,CAACI,aAAH,CAArB;;EAEA,UAAI,CAAE,KAAK7B,KAAL,CAAWjB,OAAX,EAAN,EAA4B;EAC1B,eAAO,KAAP;EACD;;EAED,UAAI,CAAE6C,WAAW,CAACP,IAAZ,CAAiB,gBAAjB,CAAN,EAA0C;EACxC,eAAO,KAAP;EACD;;EAED,WAAKjC,OAAL,CAAa,YAAYwC,WAAW,CAACP,IAAZ,CAAiB,gBAAjB,CAAzB,EAA6DI,CAA7D,EAAgE,KAAKzB,KAArE;EACD,KA7E2C;EA+E5CoB,IAAAA,oBA/E4C,kCA+ErB;EACrB,WAAKzB,MAAL,CAAYe,IAAZ;EAEA,WAAKD,OAAL,CAAaN,IAAb,CAAkB,MAAlB,EAA0B2B,IAA1B,CAA+B,CAA/B;EAEA,WAAK1C,OAAL,CAAa,OAAb;EACD,KArF2C;EAuF5C2C,IAAAA,gBAvF4C,4BAuF3BN,CAvF2B,EAuFxB;EAClB,UAAMO,OAAO,GAAGhE,CAAC,CAACyD,CAAC,CAACI,aAAH,CAAjB;EACA,UAAMI,OAAO,GAAG,KAAKC,gBAAL,CAAsBF,OAAtB,CAAhB;EACA,UAAMG,SAAS,GAAGjE,MAAM,CAAC8D,OAAO,CAACX,IAAR,CAAa,MAAb,CAAD,CAAxB;;EAEA,UAAI,KAAKrB,KAAL,CAAWhB,GAAX,CAAe,WAAf,KAA+B,KAAKgB,KAAL,CAAWhB,GAAX,CAAe,SAAf,CAAnC,EAA8D;EAC5D,aAAKgB,KAAL,CAAWlB,iBAAX,CAA6BmD,OAA7B;EACA;EACD;;EAED,UAAI,KAAKjC,KAAL,CAAWhB,GAAX,CAAe,UAAf,KAA8BiD,OAAO,KAAK,KAAKjC,KAAL,CAAWf,GAAX,CAAe,UAAf,CAA1C,IACG,KAAKe,KAAL,CAAWhB,GAAX,CAAe,WAAf,KAA+BmD,SAAS,CAACC,QAAV,CAAmB,KAAKpC,KAAL,CAAWf,GAAX,CAAe,WAAf,CAAnB,EAAgD,KAAhD,CADtC,EAC8F;EAC5F,aAAKe,KAAL,CAAWlB,iBAAX,CAA6BmD,OAA7B;EACD,OAbiB;;;EAgBlB,UAAI,CAAC,KAAKjC,KAAL,CAAWhB,GAAX,CAAe,WAAf,CAAD,IAAgC,CAAC,KAAKgB,KAAL,CAAWhB,GAAX,CAAe,SAAf,CAArC,EAAgE;EAC9D,aAAKgB,KAAL,CAAWb,GAAX,CAAe,UAAf,EAA2B8C,OAA3B;EACA,aAAKjC,KAAL,CAAWb,GAAX,CAAe,WAAf,EAA4BgD,SAAS,CAACE,KAAV,EAA5B;EAEA,aAAKC,iBAAL,CAAuBb,CAAvB;EACA;EACD,OAtBiB;;;EAyBlB,UAAI,aAAa,KAAKjC,OAAL,CAAaI,WAA1B,IAAyCuC,SAAS,CAAC9C,IAAV,CAAe,KAAKW,KAAL,CAAWf,GAAX,CAAe,WAAf,CAAf,EAA4C,MAA5C,IAAsD,CAAnG,EAAuG;EACrG;EACD;;EAED,WAAKU,MAAL,CAAY4C,IAAZ;EACA,WAAKvC,KAAL,CAAWb,GAAX,CAAe,SAAf,EAA0BgD,SAAS,CAACE,KAAV,EAA1B;EACA,WAAKjD,OAAL,CAAa,OAAb,EAAsB,KAAKY,KAA3B,EAAkC,IAAlC;EACD,KAvH2C;EAyH5CmB,IAAAA,iBAzH4C,+BAyHxB;EAClB,UAAMzC,OAAO,GAAG,KAAKsB,KAAL,CAAWf,GAAX,CAAe,SAAf,CAAhB;EACA,UAAMN,SAAS,GAAG,KAAKqB,KAAL,CAAWf,GAAX,CAAe,WAAf,CAAlB;;EAEA,UAAIc,CAAC,CAACyC,MAAF,CAAS7D,SAAT,KAAuBoB,CAAC,CAACyC,MAAF,CAAS9D,OAAT,CAA3B,EAA8C;EAC5C,aAAK+B,OAAL,CAAagC,GAAb,CAAiB,OAAjB,EAA0BtE,YAA1B,EAAwCuC,IAAxC;EACA;EACD;;EAED,UAAMgC,YAAY,GAAG,KAAKC,gBAAL,CACnB,KAAK3C,KAAL,CAAWf,GAAX,CAAe,UAAf,CADmB,EACSN,SADT,CAArB;;EAIA,UAAIoB,CAAC,CAACyC,MAAF,CAAS9D,OAAT,CAAJ,EAAuB;EACrB,YAAMkE,QAAQ,GAAG,KAAKC,eAAL,CAAqBH,YAArB,CAAjB;EACA,aAAKjC,OAAL,CAAa8B,IAAb,GAAoBE,GAApB,CAAwB;EAAEK,UAAAA,GAAG,EAAEF,QAAQ,CAACE,GAAhB;EAAqBC,UAAAA,IAAI,EAAEH,QAAQ,CAACG;EAApC,SAAxB;EACD,OAHD,MAGO;EACL,YAAMC,UAAU,GAAG,KAAKL,gBAAL,CAAsB,KAAK3C,KAAL,CAAWf,GAAX,CAAe,UAAf,CAAtB,EAAkDP,OAAlD,CAAnB;EACA,aAAK+B,OAAL,CAAagC,GAAb,CAAiB,OAAjB,EAA0B,CAACO,UAAU,CAACC,KAAX,KAAqBP,YAAY,CAACO,KAAb,EAArB,GAA4C,CAA7C,IAAkD9E,YAA5E;EACD;EACF,KA7I2C;EA+I5CmE,IAAAA,iBA/I4C,6BA+I1Bb,CA/I0B,EA+IvB;EACnB,UAAMO,OAAO,GAAGhE,CAAC,CAACyD,CAAC,CAACI,aAAH,CAAjB;EACA,UAAMqB,UAAU,GAAG,KAAKhB,gBAAL,CAAsBF,OAAtB,CAAnB;;EAEA,UAAI,CAAC,KAAKhC,KAAL,CAAWhB,GAAX,CAAe,UAAf,CAAD,IACC,KAAKgB,KAAL,CAAWf,GAAX,CAAe,UAAf,MAA+BiE,UADhC,IAEC,CAAC,KAAKlD,KAAL,CAAWhB,GAAX,CAAe,WAAf,CAFF,IAGC,KAAKgB,KAAL,CAAWhB,GAAX,CAAe,WAAf,KAA+B,KAAKgB,KAAL,CAAWhB,GAAX,CAAe,SAAf,CAHpC,EAG+D;EAC7D;EACD;;EAED,UAAMmE,SAAS,GAAGjF,MAAM,CAAC8D,OAAO,CAACX,IAAR,CAAa,MAAb,CAAD,CAAxB;EACA,UAAM1C,SAAS,GAAG,KAAKqB,KAAL,CAAWf,GAAX,CAAe,WAAf,CAAlB;;EAEA,UAAIN,SAAS,CAACyE,cAAV,CAAyBD,SAAzB,EAAoC,KAApC,CAAJ,EAAgD;EAC9C,YAAMT,YAAY,GAAG,KAAKC,gBAAL,CAAsBO,UAAtB,EAAkCvE,SAAlC,CAArB;EACA,YAAM0E,IAAI,GAAIrB,OAAO,CAACiB,KAAR,KAAkBP,YAAY,CAACO,KAAb,EAAlB,GAAyC,CAAvD;EAEA,aAAKxC,OAAL,CAAagC,GAAb,CAAiB,OAAjB,EAA0BY,IAAI,GAAGlF,YAAjC;EACA,aAAKsC,OAAL,CAAaN,IAAb,CAAkB,MAAlB,EAA0B2B,IAA1B,CAA+B,WAAW,KAAKtC,OAAL,CAAaI,WAAxB,GAAsCyD,IAAtC,GAA6CA,IAAI,GAAG,CAAnF;EACD;EACF,KApK2C;EAsK5CV,IAAAA,gBAtK4C,4BAsK3B/D,QAtK2B,EAsKjB0E,IAtKiB,EAsKX;EAC/B,UAAI,QAAOA,IAAP,MAAgB,QAApB,EAA8B;EAC5BA,QAAAA,IAAI,GAAGA,IAAI,CAAC9B,MAAL,CAAYpD,WAAZ,CAAP;EACD;;EAED,aAAO,KAAK8B,GAAL,CACJC,IADI,CACC,qBAAqBvB,QAArB,GAAgC,IADjC,EAEJuB,IAFI,CAEC,iCAAiCmD,IAAjC,GAAwC,IAFzC,CAAP;EAGD,KA9K2C;EAgL5CpB,IAAAA,gBAhL4C,4BAgL3BqB,OAhL2B,EAgLlB;EACxB,UAAI3E,QAAQ,GAAGZ,CAAC,CAACuF,OAAD,CAAD,CAAWlC,IAAX,CAAgB,UAAhB,CAAf;;EAEA,UAAI,OAAOzC,QAAP,KAAoB,WAAxB,EAAqC;EACnCA,QAAAA,QAAQ,GAAGZ,CAAC,CAACuF,OAAD,CAAD,CAAWC,OAAX,CAAmB,iBAAnB,EAAsCnC,IAAtC,CAA2C,UAA3C,CAAX;EACD;;EAEDzC,MAAAA,QAAQ,GAAG6E,QAAQ,CAAC7E,QAAD,EAAW,EAAX,CAAnB;EACA,aAAO,CAAE8E,KAAK,CAAC9E,QAAD,CAAP,GAAoBA,QAApB,GAA+B,CAAtC;EACD,KAzL2C;EA2L5CiE,IAAAA,eA3L4C,2BA2L5BU,OA3L4B,EA2LnB;EACvB,UAAMI,QAAQ,GAAGJ,OAAO,CAACK,MAAR,EAAjB;EACA,UAAMC,SAAS,GAAG,KAAK3D,GAAL,CAASC,IAAT,CAAc,kBAAd,EAAkCyD,MAAlC,EAAlB;EAEA,aAAO;EACLd,QAAAA,GAAG,EAAEa,QAAQ,CAACb,GAAT,GAAee,SAAS,CAACf,GADzB;EAELC,QAAAA,IAAI,EAAEY,QAAQ,CAACZ,IAAT,GAAgBc,SAAS,CAACd;EAF3B,OAAP;EAID,KAnM2C;;EAqM5C;;;;;EAKApC,IAAAA,WA1M4C,yBA0M9B;EACZmD,MAAAA,KAAK,CAAC,KAAKrD,OAAL,CAAa,CAAb,CAAD,EAAkB;EACrBsD,QAAAA,IAAI,EAAE,KAAK7D,GAAL,CAASC,IAAT,CAAc,KAAKX,OAAL,CAAaG,MAA3B,EAAmC,CAAnC,CADe;EAErBqE,QAAAA,KAAK,EAAE,YAFc;EAGrBC,QAAAA,KAAK,EAAE,IAHc;EAIrBC,QAAAA,QAAQ,EAAE,CAJW;EAKrB9E,QAAAA,OAAO,EAAE,QALY;EAMrB+E,QAAAA,SAAS,EAAE,QANU;EAOrBC,QAAAA,WAAW,EAAE,YAPQ;EAQrBC,QAAAA,WAAW,EAAE,IARQ;EASrBC,QAAAA,WAAW,EAAE,IATQ;EAUrBC,QAAAA,SAAS,EAAE,YAVU;EAWrBC,QAAAA,QAAQ,EAAE,CAAC,GAAD,EAAM,GAAN,CAXW;EAYrBC,QAAAA,aAAa,EAAE;EAAEC,UAAAA,SAAS,EAAE;EAC1BhE,YAAAA,IAAI,EAAE;EAAEiE,cAAAA,OAAO,EAAE;EAAX,aADoB;EAE1BC,YAAAA,eAAe,EAAE;EAAED,cAAAA,OAAO,EAAE;EAAX;EAFS;EAAb;EAZM,OAAlB,CAAL;EAiBD,KA5N2C;;EA8N5C;;;;;EAKA5D,IAAAA,iBAnO4C,+BAmOxB;EAClB,UAAM8D,IAAI,GAAG,IAAb;EACA,UAAMC,YAAY,GAAGD,IAAI,CAAC3E,GAAL,CAASC,IAAT,CAAc,kBAAd,EAAkC,CAAlC,CAArB;;EAEA,UAAM4E,SAAS,GAAG,SAAZA,SAAY,CAASC,SAAT,EAAoB;EACpC,YAAMC,UAAU,GAAMJ,IAAI,CAAC3E,GAAL,CAASC,IAAT,CAAc,2CAAd,CAAtB;EACA,YAAM+E,aAAa,GAAGlH,CAAC,CAAC,KAAKuF,OAAN,CAAvB;;EAEA,YAAI,YAAYyB,SAAhB,EAA2B;EACzBE,UAAAA,aAAa,CAACC,IAAd,CAAmB,gBAAnB,EAAqCF,UAAU,CAACnD,IAAX,EAArC;EACAmD,UAAAA,UAAU,CAACnD,IAAX,CAAgBoD,aAAa,CAACpD,IAAd,EAAhB;EACD,SAHD,MAGO;EACLmD,UAAAA,UAAU,CAACnD,IAAX,CAAgBoD,aAAa,CAAC7D,IAAd,CAAmB,UAAnB,CAAhB;EACA6D,UAAAA,aAAa,CAACC,IAAd,CAAmB,gBAAnB,EAAqC,EAArC;EACD;EACF,OAXD;;EAaAN,MAAAA,IAAI,CAAC3E,GAAL,CAASC,IAAT,CAAc,yBAAd,EAAyCiF,IAAzC,CAA8C,YAAW;EACvD,YAAItE,QAAJ,CAAa;EACXyC,UAAAA,OAAO,EAAE,IADE;EAEX8B,UAAAA,OAAO,EAAEP,YAFE;EAGXlB,UAAAA,MAAM,EAAE,CAAC,EAHE;EAIX0B,UAAAA,UAAU,EAAE,IAJD;EAKXC,UAAAA,OAAO,EAAER;EALE,SAAb;EAOD,OARD;EASD;EA7P2C,GAArB,CAAzB;EAgQAlE,EAAAA,MAAM,CAACvB,gBAAP,GAA0BA,gBAA1B;EAED,CA5SD,EA4SGkG,MA5SH,EA4SW3E,MAAM,CAAC5C,SA5SlB,EA4S6B4C,MAAM,CAAC3C,MA5SpC;;;;"}