{"version":3,"file":"edit-booking.js","sources":["assets/babel/admin/edit-booking.js"],"sourcesContent":["(function($, plugin) {\n  'use strict';\n\n  const localize = window._awebookingEditBooking || {};\n  const i18n     = localize.i18n || {};\n\n  /**\n   * Handle the xhr fail.\n   *\n   * @param  {jqXHR} xhr\n   * @return {void}\n   */\n  const handleXhrFail = function(xhr) {\n    xhr.fail(function(xhr) {\n      const res = xhr.responseJSON || $.parseJSON(xhr.responseText);\n\n      if (res.message) {\n        plugin.alert(res.message, res.status);\n      }\n\n      if (plugin.debug) {\n        console.log(xhr);\n      }\n    });\n  };\n\n  class EditBooking {\n    /**\n     * Constructor.\n     *\n     * @return {void}\n     */\n    constructor() {\n      $('.js-editnow').click(this.handleEditAddress);\n\n      $('#js-add-note').click(this.handleAddNote);\n      $(document).on( 'click', '.js-delete-note', this.handleDeleteNote);\n    }\n\n    /**\n     * Handle toggle edit address.\n     *\n     * @param  {Event} e\n     * @return {void}\n     */\n    handleEditAddress(e) {\n      e.preventDefault();\n\n      const focus = $(this).data('focus');\n      const $wrapper = $(this).closest('.js-booking-column');\n\n      $wrapper.find('h3 > a.button-editnow').hide();\n      $wrapper.find('div.js-booking-data').hide();\n      $wrapper.find('div.js-edit-booking-data').show();\n\n      if (focus && $(focus, $wrapper).length) {\n        $(focus, $wrapper).focus();\n      }\n    }\n\n    /**\n     * Handle click add note button.\n     *\n     * @param  {Event} e\n     * @return {void}\n     */\n    handleAddNote(e) {\n      e.preventDefault();\n\n      const $notes = $('#js-booking-notes');\n      const $noteInput = $('#js-booking-note');\n\n      let content = (new String($noteInput.val())).trim();\n      if (content.length === 0) {\n        plugin.alert(i18n.empty_note_warning, 'warning');\n        return;\n      }\n\n      let noteType = '';\n      if ($('#js-customer-note').prop('checked') === true) {\n        noteType = 'customer';\n      }\n\n      const xhr = $.ajax({\n        type: 'POST',\n        url:  plugin.route('/ajax/booking-note'),\n        data: {\n          note:        content,\n          note_type:   noteType,\n          booking:     parseInt($('#post_ID').val(), 10),\n          _ajax_nonce: localize.add_note_nonce,\n        }\n      });\n\n      xhr.done(function(res) {\n        $noteInput.val('');\n        $(res.data).prependTo($notes);\n\n        if ($notes.find('.awebooking-no-items').length) {\n          $notes.find('.awebooking-no-items').closest('li').remove();\n        }\n      });\n\n      handleXhrFail(xhr);\n    }\n\n    /**\n     * Handle delete note.\n     *\n     * @param  {Event} e\n     * @return {void}\n     */\n    handleDeleteNote(e) {\n      e.preventDefault();\n\n      const $el = $(this).closest('.booking-note');\n      if (! $el.length || !$el.attr('rel')) {\n        return;\n      }\n\n      plugin.confirm(i18n.delete_note_warning, function() {\n        const noteID = parseInt($el.attr('rel'), 10);\n\n        const xhr = $.ajax({\n          type: 'POST',\n          url:   plugin.route('/ajax/booking-note/' + noteID),\n          data: { _method: 'DELETE', _ajax_nonce: localize.delete_note_nonce }\n        });\n\n        xhr.done(function() {\n          $el.slideUp(100, function() { $el.remove() });\n        });\n\n        handleXhrFail(xhr);\n      });\n    }\n  }\n\n  // Document ready!\n  $(function() {\n    plugin.instances.editBooking = new EditBooking;\n  });\n\n})(jQuery, window.awebooking || {});\n"],"names":["$","plugin","localize","window","_awebookingEditBooking","i18n","handleXhrFail","xhr","fail","res","responseJSON","parseJSON","responseText","message","alert","status","debug","console","log","EditBooking","click","handleEditAddress","handleAddNote","document","on","handleDeleteNote","e","preventDefault","focus","data","$wrapper","closest","find","hide","show","length","$notes","$noteInput","content","String","val","trim","empty_note_warning","noteType","prop","ajax","type","url","route","note","note_type","booking","parseInt","_ajax_nonce","add_note_nonce","done","prependTo","remove","$el","attr","confirm","delete_note_warning","noteID","_method","delete_note_nonce","slideUp","instances","editBooking","jQuery","awebooking"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;EAAA,CAAC,UAASA,CAAT,EAAYC,MAAZ,EAAoB;AACnB;EAEA,MAAMC,QAAQ,GAAGC,MAAM,CAACC,sBAAP,IAAiC,EAAlD;EACA,MAAMC,IAAI,GAAOH,QAAQ,CAACG,IAAT,IAAiB,EAAlC;EAEA;;;;;;;EAMA,MAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAASC,GAAT,EAAc;EAClCA,IAAAA,GAAG,CAACC,IAAJ,CAAS,UAASD,GAAT,EAAc;EACrB,UAAME,GAAG,GAAGF,GAAG,CAACG,YAAJ,IAAoBV,CAAC,CAACW,SAAF,CAAYJ,GAAG,CAACK,YAAhB,CAAhC;;EAEA,UAAIH,GAAG,CAACI,OAAR,EAAiB;EACfZ,QAAAA,MAAM,CAACa,KAAP,CAAaL,GAAG,CAACI,OAAjB,EAA0BJ,GAAG,CAACM,MAA9B;EACD;;EAED,UAAId,MAAM,CAACe,KAAX,EAAkB;EAChBC,QAAAA,OAAO,CAACC,GAAR,CAAYX,GAAZ;EACD;EACF,KAVD;EAWD,GAZD;;EAZmB,MA0BbY,WA1Ba;EAAA;EAAA;EA2BjB;;;;;EAKA,2BAAc;EAAA;;EACZnB,MAAAA,CAAC,CAAC,aAAD,CAAD,CAAiBoB,KAAjB,CAAuB,KAAKC,iBAA5B;EAEArB,MAAAA,CAAC,CAAC,cAAD,CAAD,CAAkBoB,KAAlB,CAAwB,KAAKE,aAA7B;EACAtB,MAAAA,CAAC,CAACuB,QAAD,CAAD,CAAYC,EAAZ,CAAgB,OAAhB,EAAyB,iBAAzB,EAA4C,KAAKC,gBAAjD;EACD;EAED;;;;;;;;EAvCiB;EAAA;EAAA,wCA6CCC,CA7CD,EA6CI;EACnBA,QAAAA,CAAC,CAACC,cAAF;EAEA,YAAMC,KAAK,GAAG5B,CAAC,CAAC,IAAD,CAAD,CAAQ6B,IAAR,CAAa,OAAb,CAAd;EACA,YAAMC,QAAQ,GAAG9B,CAAC,CAAC,IAAD,CAAD,CAAQ+B,OAAR,CAAgB,oBAAhB,CAAjB;EAEAD,QAAAA,QAAQ,CAACE,IAAT,CAAc,uBAAd,EAAuCC,IAAvC;EACAH,QAAAA,QAAQ,CAACE,IAAT,CAAc,qBAAd,EAAqCC,IAArC;EACAH,QAAAA,QAAQ,CAACE,IAAT,CAAc,0BAAd,EAA0CE,IAA1C;;EAEA,YAAIN,KAAK,IAAI5B,CAAC,CAAC4B,KAAD,EAAQE,QAAR,CAAD,CAAmBK,MAAhC,EAAwC;EACtCnC,UAAAA,CAAC,CAAC4B,KAAD,EAAQE,QAAR,CAAD,CAAmBF,KAAnB;EACD;EACF;EAED;;;;;;;EA5DiB;EAAA;EAAA,oCAkEHF,CAlEG,EAkEA;EACfA,QAAAA,CAAC,CAACC,cAAF;EAEA,YAAMS,MAAM,GAAGpC,CAAC,CAAC,mBAAD,CAAhB;EACA,YAAMqC,UAAU,GAAGrC,CAAC,CAAC,kBAAD,CAApB;EAEA,YAAIsC,OAAO,GAAI,IAAIC,MAAJ,CAAWF,UAAU,CAACG,GAAX,EAAX,CAAD,CAA+BC,IAA/B,EAAd;;EACA,YAAIH,OAAO,CAACH,MAAR,KAAmB,CAAvB,EAA0B;EACxBlC,UAAAA,MAAM,CAACa,KAAP,CAAaT,IAAI,CAACqC,kBAAlB,EAAsC,SAAtC;EACA;EACD;;EAED,YAAIC,QAAQ,GAAG,EAAf;;EACA,YAAI3C,CAAC,CAAC,mBAAD,CAAD,CAAuB4C,IAAvB,CAA4B,SAA5B,MAA2C,IAA/C,EAAqD;EACnDD,UAAAA,QAAQ,GAAG,UAAX;EACD;;EAED,YAAMpC,GAAG,GAAGP,CAAC,CAAC6C,IAAF,CAAO;EACjBC,UAAAA,IAAI,EAAE,MADW;EAEjBC,UAAAA,GAAG,EAAG9C,MAAM,CAAC+C,KAAP,CAAa,oBAAb,CAFW;EAGjBnB,UAAAA,IAAI,EAAE;EACJoB,YAAAA,IAAI,EAASX,OADT;EAEJY,YAAAA,SAAS,EAAIP,QAFT;EAGJQ,YAAAA,OAAO,EAAMC,QAAQ,CAACpD,CAAC,CAAC,UAAD,CAAD,CAAcwC,GAAd,EAAD,EAAsB,EAAtB,CAHjB;EAIJa,YAAAA,WAAW,EAAEnD,QAAQ,CAACoD;EAJlB;EAHW,SAAP,CAAZ;EAWA/C,QAAAA,GAAG,CAACgD,IAAJ,CAAS,UAAS9C,GAAT,EAAc;EACrB4B,UAAAA,UAAU,CAACG,GAAX,CAAe,EAAf;EACAxC,UAAAA,CAAC,CAACS,GAAG,CAACoB,IAAL,CAAD,CAAY2B,SAAZ,CAAsBpB,MAAtB;;EAEA,cAAIA,MAAM,CAACJ,IAAP,CAAY,sBAAZ,EAAoCG,MAAxC,EAAgD;EAC9CC,YAAAA,MAAM,CAACJ,IAAP,CAAY,sBAAZ,EAAoCD,OAApC,CAA4C,IAA5C,EAAkD0B,MAAlD;EACD;EACF,SAPD;EASAnD,QAAAA,aAAa,CAACC,GAAD,CAAb;EACD;EAED;;;;;;;EA1GiB;EAAA;EAAA,uCAgHAmB,CAhHA,EAgHG;EAClBA,QAAAA,CAAC,CAACC,cAAF;EAEA,YAAM+B,GAAG,GAAG1D,CAAC,CAAC,IAAD,CAAD,CAAQ+B,OAAR,CAAgB,eAAhB,CAAZ;;EACA,YAAI,CAAE2B,GAAG,CAACvB,MAAN,IAAgB,CAACuB,GAAG,CAACC,IAAJ,CAAS,KAAT,CAArB,EAAsC;EACpC;EACD;;EAED1D,QAAAA,MAAM,CAAC2D,OAAP,CAAevD,IAAI,CAACwD,mBAApB,EAAyC,YAAW;EAClD,cAAMC,MAAM,GAAGV,QAAQ,CAACM,GAAG,CAACC,IAAJ,CAAS,KAAT,CAAD,EAAkB,EAAlB,CAAvB;EAEA,cAAMpD,GAAG,GAAGP,CAAC,CAAC6C,IAAF,CAAO;EACjBC,YAAAA,IAAI,EAAE,MADW;EAEjBC,YAAAA,GAAG,EAAI9C,MAAM,CAAC+C,KAAP,CAAa,wBAAwBc,MAArC,CAFU;EAGjBjC,YAAAA,IAAI,EAAE;EAAEkC,cAAAA,OAAO,EAAE,QAAX;EAAqBV,cAAAA,WAAW,EAAEnD,QAAQ,CAAC8D;EAA3C;EAHW,WAAP,CAAZ;EAMAzD,UAAAA,GAAG,CAACgD,IAAJ,CAAS,YAAW;EAClBG,YAAAA,GAAG,CAACO,OAAJ,CAAY,GAAZ,EAAiB,YAAW;EAAEP,cAAAA,GAAG,CAACD,MAAJ;EAAc,aAA5C;EACD,WAFD;EAIAnD,UAAAA,aAAa,CAACC,GAAD,CAAb;EACD,SAdD;EAeD;EAvIgB;;EAAA;EAAA;;;EA2InBP,EAAAA,CAAC,CAAC,YAAW;EACXC,IAAAA,MAAM,CAACiE,SAAP,CAAiBC,WAAjB,GAA+B,IAAIhD,WAAJ,EAA/B;EACD,GAFA,CAAD;EAID,CA/ID,EA+IGiD,MA/IH,EA+IWjE,MAAM,CAACkE,UAAP,IAAqB,EA/IhC;;;;"}