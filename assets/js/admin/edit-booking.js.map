{"version":3,"file":"edit-booking.js","sources":["assets/babel/admin/edit-booking.js"],"sourcesContent":["(function($, plugin) {\n  'use strict';\n\n  const localize = window._awebookingEditBooking || {};\n  const i18n     = localize.i18n || {};\n\n  /**\n   * Handle the xhr fail.\n   *\n   * @param  {jqXHR} xhr\n   * @return {void}\n   */\n  const handleXhrFail = function(xhr) {\n    xhr.fail(function(xhr) {\n      const res = xhr.responseJSON || $.parseJSON(xhr.responseText);\n\n      if (res.message) {\n        plugin.alert(res.message, res.status);\n      }\n\n      if (plugin.debug) {\n        console.log(xhr);\n      }\n    });\n  };\n\n  class EditBooking {\n    /**\n     * Constructor.\n     *\n     * @return {void}\n     */\n    constructor() {\n      $('.js-editnow').click(this.handleEditAddress);\n\n      $('#js-add-note').click(this.handleAddNote);\n      $(document).on( 'click', '.js-delete-note', this.handleDeleteNote);\n    }\n\n    /**\n     * Handle toggle edit address.\n     *\n     * @param  {Event} e\n     * @return {void}\n     */\n    handleEditAddress(e) {\n      e.preventDefault();\n\n      const focus = $(this).data('focus');\n      const $wrapper = $(this).closest('.js-booking-column');\n\n      $wrapper.find('h3 > a.button-editnow').hide();\n      $wrapper.find('div.js-booking-data').hide();\n      $wrapper.find('div.js-edit-booking-data').show();\n\n      if (focus && $(focus, $wrapper).length) {\n        $(focus, $wrapper).focus();\n      }\n    }\n\n    /**\n     * Handle click add note button.\n     *\n     * @param  {Event} e\n     * @return {void}\n     */\n    handleAddNote(e) {\n      e.preventDefault();\n\n      const $notes = $('#js-booking-notes');\n      const $noteInput = $('#js-booking-note');\n\n      let content = (new String($noteInput.val())).trim();\n      if (content.length === 0) {\n        plugin.alert(i18n.empty_note_warning, 'warning');\n        return;\n      }\n\n      let noteType = '';\n      if ($('#js-customer-note').prop('checked') === true) {\n        noteType = 'customer';\n      }\n\n      const xhr = $.ajax({\n        type: 'POST',\n        url:  plugin.route('/ajax/booking-note'),\n        data: {\n          note:        content,\n          note_type:   noteType,\n          booking:     parseInt($('#post_ID').val(), 10),\n          _ajax_nonce: localize.add_note_nonce,\n        }\n      });\n\n      xhr.done(function(res) {\n        $noteInput.val('');\n        $(res.data).prependTo($notes);\n\n        if ($notes.find('.awebooking-no-items').length) {\n          $notes.find('.awebooking-no-items').closest('li').remove();\n        }\n      });\n\n      handleXhrFail(xhr);\n    }\n\n    /**\n     * Handle delete note.\n     *\n     * @param  {Event} e\n     * @return {void}\n     */\n    handleDeleteNote(e) {\n      e.preventDefault();\n\n      const $el = $(this).closest('.booking-note');\n      if (! $el.length || !$el.attr('rel')) {\n        return;\n      }\n\n      plugin.confirm(i18n.delete_note_warning, function() {\n        const noteID = parseInt($el.attr('rel'), 10);\n\n        const xhr = $.ajax({\n          type: 'POST',\n          url:   plugin.route('/ajax/booking-note/' + noteID),\n          data: { _method: 'DELETE', _ajax_nonce: localize.delete_note_nonce }\n        });\n\n        xhr.done(function() {\n          $el.slideUp(100, function() { $el.remove() });\n        });\n\n        handleXhrFail(xhr);\n      });\n    }\n  }\n\n  // Document ready!\n  $(function() {\n    plugin.instances.editBooking = new EditBooking;\n  });\n\n})(jQuery, window.awebooking || {});\n"],"names":["$","plugin","localize","window","_awebookingEditBooking","i18n","handleXhrFail","xhr","fail","res","responseJSON","parseJSON","responseText","message","alert","status","debug","console","log","EditBooking","click","handleEditAddress","handleAddNote","document","on","handleDeleteNote","e","preventDefault","focus","data","$wrapper","closest","find","hide","show","length","$notes","$noteInput","content","String","val","trim","empty_note_warning","noteType","prop","ajax","type","url","route","note","note_type","booking","parseInt","_ajax_nonce","add_note_nonce","done","prependTo","remove","$el","attr","confirm","delete_note_warning","noteID","_method","delete_note_nonce","slideUp","instances","editBooking","jQuery","awebooking"],"mappings":"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"}