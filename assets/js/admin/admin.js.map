{"version":3,"names":[],"mappings":"","sources":["admin/admin.js"],"sourcesContent":["const debounce = require('debounce');\r\nconst queryString = require('query-string');\r\nconst Dropdown = require('../core/dropdown');\r\n\r\n(function($) {\r\n  'use strict';\r\n\r\n  const awebooking = window.awebooking || {};\r\n\r\n  // Create the properties.\r\n  awebooking.utils = {};\r\n  awebooking.instances = {};\r\n\r\n  awebooking.utils.flatpickrRangePlugin = require('../core/range-dates.js');\r\n\r\n  /**\r\n   * The admin route.\r\n   *\r\n   * @param  {string} route\r\n   * @return {string}\r\n   */\r\n  awebooking.route = function(route) {\r\n    return this.admin_route + route.replace(/^\\//g, '');\r\n  };\r\n\r\n  /**\r\n   * Show the alert dialog.\r\n   *\r\n   * @return {SweetAlert}\r\n   */\r\n  awebooking.alert = function(message, type = 'error') {\r\n    return swal({\r\n      text: message,\r\n      type: type,\r\n      toast: true,\r\n      buttonsStyling: false,\r\n      showCancelButton: false,\r\n      showConfirmButton: true,\r\n      confirmButtonClass: 'button'\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Show the confirm message.\r\n   *\r\n   * @return {SweetAlert}\r\n   */\r\n  awebooking.confirm = function(message, callback) {\r\n    if (! window.swal) {\r\n      return window.confirm(message || this.i18n.warning) && callback();\r\n    }\r\n\r\n    const confirm = window.swal({\r\n      toast: true,\r\n      text: message || this.i18n.warning,\r\n      type: 'warning',\r\n      position: 'center',\r\n      reverseButtons: true,\r\n      buttonsStyling: false,\r\n      showCancelButton: true,\r\n      cancelButtonClass: 'button',\r\n      confirmButtonClass: 'button button-primary',\r\n      cancelButtonText: this.i18n.cancel,\r\n      confirmButtonText: this.i18n.ok,\r\n    });\r\n\r\n    if (callback) {\r\n      return confirm.then(function(result) {\r\n        if (result.value) callback(result);\r\n      });\r\n    }\r\n\r\n    return confirm;\r\n  };\r\n\r\n  /**\r\n   * Create the dialog.\r\n   *\r\n   * @param  {string} selector\r\n   * @return {Object}\r\n   */\r\n  awebooking.dialog = function(selector) {\r\n    const $dialog = $(selector).dialog({\r\n      modal: true,\r\n      width: 'auto',\r\n      height: 'auto',\r\n      autoOpen: false,\r\n      draggable: false,\r\n      resizable: false,\r\n      closeOnEscape: true,\r\n      dialogClass: 'wp-dialog awebooking-dialog',\r\n      position: { my: 'center', at: 'center center-15%', of: window },\r\n    });\r\n\r\n    $(window).resize(debounce(() => {\r\n      $dialog.dialog('option', 'position', { my: 'center', at: 'center center-15%', of: window });\r\n    }, 150));\r\n\r\n    return $dialog;\r\n  };\r\n\r\n  /**\r\n   * Send a ajax request to a route.\r\n   *\r\n   * @param  {String}   route\r\n   * @param  {Object}   data\r\n   * @param  {Function} callback\r\n   * @return {Object}\r\n   */\r\n  awebooking.ajax = function(method, route, data, callback) {\r\n    return $.ajax({\r\n      url: awebooking.route(route),\r\n      data: data,\r\n      method: method,\r\n      dataType: 'json',\r\n    })\r\n    .done((data) => {\r\n      if(callback) callback(data);\r\n    })\r\n    .fail((xhr) => {\r\n      const json = xhr.responseJSON;\r\n\r\n      if (json && json.message) {\r\n        awebooking.alert(json.message, 'error');\r\n      } else {\r\n        awebooking.alert(awebooking.i18n.error, 'error');\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Create a form then append to body.\r\n   *\r\n   * @param  {String} link   The form action.\r\n   * @param  {String} method The form method.\r\n   * @return {Object}\r\n   */\r\n  awebooking.createForm = function(action, method) {\r\n    const $form = $('<form>', { 'method': 'POST', 'action': action });\r\n\r\n    const hiddenInput = $('<input>', { 'name': '_method',  'type': 'hidden', 'value': method });\r\n\r\n    return $form.append(hiddenInput).appendTo('body');\r\n  };\r\n\r\n  /**\r\n   * Format the price.\r\n   *\r\n   * @param amount\r\n   * @returns {string}\r\n   */\r\n  awebooking.formatPrice = function(amount) {\r\n    return require('accounting').formatMoney(amount, {\r\n      format: awebooking.i18n.priceFormat,\r\n      symbol: awebooking.i18n.currencySymbol,\r\n      decimal: awebooking.i18n.decimalSeparator,\r\n      thousand: awebooking.i18n.priceThousandSeparator,\r\n      precision: awebooking.i18n.numberDecimals,\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Retrieves a modified URL query string.\r\n   *\r\n   * @param {object} args\r\n   * @param {string} url\r\n   */\r\n  awebooking.utils.addQueryArgs =function(args, url) {\r\n    if (typeof url === 'undefined') {\r\n      url = window.location.href;\r\n    }\r\n\r\n    const parsed = queryString.parseUrl(url);\r\n    const query  = $.extend({}, parsed.query, args);\r\n\r\n    return parsed.url + '?' + queryString.stringify(query, { sort: false });\r\n  };\r\n\r\n  $(function() {\r\n    // Init tippy.\r\n    if (window.tippy) {\r\n      window.tippy('.tippy', {\r\n        arrow: true,\r\n        animation: 'shift-toward',\r\n        duration: [200, 150],\r\n      });\r\n    }\r\n\r\n    // Init the selectize.\r\n    if ($.fn.selectize) {\r\n      require('./utils/search-customer.js')();\r\n\r\n      $('select.selectize, .with-selectize .cmb2_select').selectize({\r\n        allowEmptyOption: true,\r\n        searchField: ['value', 'text'],\r\n      });\r\n    }\r\n\r\n    // Init warning before delete.\r\n    $('[data-method=\"abrs-delete\"]').on( 'click', function(e) {\r\n      e.preventDefault();\r\n\r\n      const link = $(this).attr('href');\r\n      const message = $(this).data('warning');\r\n\r\n      awebooking.confirm(message, function() {\r\n        awebooking.createForm(link, 'DELETE').submit();\r\n      });\r\n    });\r\n\r\n    $('[data-init=\"abrs-dropdown\"]').each(function () {\r\n      $(this).data('abrs-dropdown', new Dropdown(this, {\r\n        drop: '.abrs-drop',\r\n      }));\r\n    });\r\n\r\n  });\r\n\r\n})(jQuery);\r\n"],"file":"admin.js"}